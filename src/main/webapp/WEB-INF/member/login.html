<div class="modal-dialog modal-dialog-centered login-pop-form"
	role="document">
	<div class="modal-content" id="registermodal">
		<span class="mod-close" data-bs-dismiss="modal" aria-hidden="true">
			<span class="svg-icon text-primary svg-icon-2hx"> <svg
					width="32" height="32" viewBox="0 0 24 24" fill="none"
					xmlns="http://www.w3.org/2000/svg">
                    <rect opacity="0.3" x="2" y="2" width="20"
						height="20" rx="10" fill="currentColor" />
                    <rect x="7" y="15.3137" width="12" height="2" rx="1"
						transform="rotate(-45 7 15.3137)" fill="currentColor" />
                    <rect x="8.41422" y="7" width="12" height="2" rx="1"
						transform="rotate(45 8.41422 7)" fill="currentColor" />
                </svg>
		</span>
		</span>
		<div class="modal-body">
			<h4 class="modal-header-title">登入</h4>
			<div class="d-flex align-items-center justify-content-center mb-3">
				<span class="svg-icon text-primary svg-icon-2hx"> <svg
						width="80" height="80" viewBox="0 0 24 24" fill="none"
						xmlns="http://www.w3.org/2000/svg">
                        <path
							d="M15.8797 15.375C15.9797 15.075 15.9797 14.775 15.9797 14.475C15.9797 13.775 15.7797 13.075 15.4797 12.475C14.7797 11.275 13.4797 10.475 11.9797 10.475C11.7797 10.475 11.5797 10.475 11.3797 10.575C7.37971 11.075 4.67971 14.575 2.57971 18.075L10.8797 3.675C11.3797 2.775 12.5797 2.775 13.0797 3.675C13.1797 3.875 13.2797 3.975 13.3797 4.175C15.2797 7.575 16.9797 11.675 15.8797 15.375Z"
							fill="currentColor" />
                        <path opacity="0.3"
							d="M20.6797 20.6749C16.7797 20.6749 12.3797 20.275 9.57972 17.575C10.2797 18.075 11.0797 18.375 11.9797 18.375C13.4797 18.375 14.7797 17.5749 15.4797 16.2749C15.6797 15.9749 15.7797 15.675 15.7797 15.375V15.2749C16.8797 11.5749 15.2797 7.47495 13.2797 4.07495L21.6797 18.6749C22.2797 19.5749 21.6797 20.6749 20.6797 20.6749ZM8.67972 18.6749C8.17972 17.8749 7.97972 16.975 7.77972 15.975C7.37972 13.575 8.67972 10.775 11.3797 10.375C7.37972 10.875 4.67972 14.375 2.57972 17.875C2.47972 18.075 2.27972 18.375 2.17972 18.575C1.67972 19.475 2.27972 20.475 3.27972 20.475H10.3797C9.67972 20.175 9.07972 19.3749 8.67972 18.6749Z"
							fill="currentColor" />
                    </svg>
				</span>
			</div>
			<div class="login-form">
				<form>

					<div class="form-floating mb-3">
						<input type="email" class="form-control" id="loginemail"
							placeholder="name@example.com"> <label>請輸入Email</label>
					</div>

					<div class="form-floating mb-3">
						<input type="password" class="form-control" id="loginpassword"
							placeholder="Password"> <label>請輸入密碼</label>
					</div>

					<div class="form-group mb-3">
						<div class="d-flex align-items-center justify-content-between">
							<div class="flex-shrink-0 flex-first">
								<div class="form-check form-check-inline">
									<input class="form-check-input" type="checkbox" id="save-pass"
										value="option1"> <label class="form-check-label"
										for="save-pass">記住密碼</label>
								</div>
							</div>
							<div class="flex-shrink-0 flex-first">
								<a href="/chill-tribe/member/forgot-password.html"
									class="link fw-medium">忘記密碼?</a>
							</div>
						</div>
					</div>

					<div class="form-group">
						<button type="button"
							class="btn btn-lg btn-primary fw-medium full-width rounded-2"
							id="btn_login">登入</button>
					</div>

				</form>
			</div>
			<div class="modal-divider">
				<span>或其他登入方式</span>
			</div>
			<div class="social-login mb-3">
				<ul>
					<li><a href="#" class="btn connect-google" id="btn_googlelogin">
					<i class="ti-google"></i>Google+</a></li>
				</ul>
			</div>
			<div class="text-center">
				<p class="mt-4">
					還沒有任何帳戶？<a href="/chill-tribe/member/register.html"
						class="link fw-medium">建立帳戶</a>
				</p>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
		
		const email = document.querySelector('#loginemail');
		const password = document.querySelector('#loginpassword');
		var googleshow = true;
		var googlebtn = false;
// 		const msg = document.querySelector('#msg');


		
		// to do list 完成被勾選要記住帳號密碼&沒被勾選要清空cookie session內的key
// 	 window.onload = function () {
//     if (localStorage.getItem("email") && localStorage.getItem("password")) {
//       loginemail.value = localStorage.getItem("email");
//       loginpassword.value = localStorage.getItem("password");
//       save-pass.checked = true;
//     }
//   }
	
	
	$('#save-pass').on('change', () => {
		consle.log(save-pass);
    if (save-pass.checked) {
        console.log('Checkbox 被勾選了');
      } else {
        console.log('Checkbox 被取消勾選了');
        localStorage.removeItem("email");
        localStorage.removeItem("password");
      }
	});
		


		$('button#btn_login').on('click', () => {
			googleshow = false;
			console.log("登入按鈕觸發");
			if (!email.value) {
// 				alert('Email必須輸入');
				Swal.fire({
				  icon: "error",
				  title: "Oh...糟糕",
				  text: "Email必須輸入!",
// 				  footer: '<a href="#">Why do I have this issue?</a>'
				});
				return;
			}
			
			if (!password.value) {
// 				alert('密碼必須輸入');
				Swal.fire({
					  icon: "error",
					  title: "Oh...糟糕",
					  text: "密碼必須輸入!",
//	 				  footer: '<a href="#">Why do I have this issue?</a>'
					});
				return;
			}
			
			
			
			console.log("發送的資料：", {
			    email: email.value,
			    password: password.value,
			});
			console.log("發送登入請求");
			
			// to do list ...要判斷如果不是在member路徑底下(首頁)，如果不是要用別的
			fetch(`login/${email.value}/${password.value}`)
// 			, {
// 				method: 'POST',
// 				headers: {
// 					'Content-Type': 'application/json'
// 				},
// 				body: JSON.stringify({
// 					email: loginemail.value,
// 					password: loginpassword.value,
// 				})
// 			})
			// console.log(resp)
// 			 .then(resp => {
// 				 return resp.json();
// 			 })

			.then(resp => {
	            if (!resp.ok) {
	                throw new Error(`HTTP error! status: ${resp.status}`);
	            }
	            return resp.json(); 
	        })
	        .then(data => {
	            console.log("返回值:", data);
	            if (data.successful) {
	                console.log("登入成功");
	                if (data.memberid) {
	                    sessionStorage.setItem('memberid', data.memberid);
	                    console.log('memberid 已儲存到 sessionStorage:', data.memberid);
	                }
	                
	                window.location.href = '/chill-tribe/chilltribe.html';  
	            } else {
	                console.log("登入失敗");
	            }
	        })
	        .catch(error => {
	            console.error("錯誤訊息:", error);
	        });
	    });


	    $('#btn_googlelogin').on("click", () => {
	    	localStorage.setItem('btngooglelogin', 'true');
	    	googlebtn = true;
	        console.log("Google登入按鈕觸發");
	        // 先跳轉到 Google 認證頁面
	        location.href = "http://localhost:8080/chill-tribe/anotherOauthLogin";
		    });


//  	    


	    window.onload = function() {
		    // 發送 GET 請求以獲取 session 資料
		    fetch('googlelogin/findGoogleEmail')
		        .then(response => {
		            return response.json();
		        })
		        .then(data => {
			        if (data.email != null && data.memberid != null) {
		            	sessionStorage.setItem('GoogleEmail', data.email);
		                console.log("GoogleEmail", data.email);
		                sessionStorage.setItem('memberid', data.memberid);
		                console.log("memberid", data.memberid);
		//                 sessionStorage.setItem('name', data.name);
		//             	sessionStorage.setItem('Access Token:', data.access_token);
		                setmembername(data.memberid);
// 		                debugger;
		    			if (localStorage.getItem('btngooglelogin') == 'true') {
		    				if (sessionStorage.getItem('GoogleEmail') == null) {
		    				localStorage.setItem('btngooglelogin', 'false');
		    				window.addEventListener('load', function() {
		    					Swal.fire({
		    						  icon: "error",
		    						  title: "Oh...糟糕",
		    						  text: "請先註冊Chill Tribe的會員帳號，才能使用Google登入!",
		    		 				  footer: '<a href="http://localhost:8080/chill-tribe/member/member-register.html">前往註冊</a>'
		    						});
		    		            });
		    				console.log("googlebtn=true,memberid==null");
		    				}
		    				
		    				}
			        }
		        })
		        .catch(error => {
		            console.error("錯誤:", error);
		        });
		};
	    

		</script>
