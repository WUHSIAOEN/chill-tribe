<!-- Top header  -->
<!-- ============================================================== -->
<!-- Start Navigation -->

<div class="header header-light">
	<div class="container">
		<nav id="navigation" class="navigation navigation-landscape">
			<div class="nav-header">
				<a class="nav-brand text-logo" id="logo_href"
					href="/chilltribe.html"> <img src="./star-logo-nobg.png"
					style="width: 40px; height: 40px;" />
					<h5 class="fs-3 fw-bold ms-1 my-0">ChillTribe</h5>
				</a>
				<div class="nav-toggle"></div>
				<div class="mobile_nav">
					<ul>
						<li><a href="JavaScript:Void(0);" data-bs-toggle="modal"
							data-bs-target="#login" class="text-muted"> <span
								class="svg-icon svg-icon-2hx"> <svg width="35"
										height="35" viewBox="0 0 18 18" fill="none"
										xmlns="http://www.w3.org/2000/svg">
										<path opacity="0.3"
											d="M16.5 9C16.5 13.125 13.125 16.5 9 16.5C4.875 16.5 1.5 13.125 1.5 9C1.5 4.875 4.875 1.5 9 1.5C13.125 1.5 16.5 4.875 16.5 9Z"
											fill="currentColor" />
										<path
											d="M9 16.5C10.95 16.5 12.75 15.75 14.025 14.55C13.425 12.675 11.4 11.25 9 11.25C6.6 11.25 4.57499 12.675 3.97499 14.55C5.24999 15.75 7.05 16.5 9 16.5Z"
											fill="currentColor" />
										<rect x="7" y="6" width="4" height="4" rx="2"
											fill="currentColor" />
									</svg>
							</span>
						</a></li>
					</ul>
				</div>
			</div>
			<div class="nav-menus-wrapper" style="transition-property: none;">
				<ul class="nav-menu">

					<li class="active"><a id="index_href"
						href="../chilltribe.html">首頁<span class="submenu-indicator"></span></a></li>

					<li><a id="index_href_search-activities"
						href="../activity/search-activities.html">活動列表<span
							class="submenu-indicator"></span></a></li>

					<li><a id="index_href_contact"
						href="../general-info/contact.html">客服中心<span
							class="submenu-indicator"></span></a></li>

					<li><a id="index_href_faq" href="../general-info/faq.html">常見問題<span
							class="submenu-indicator"></span></a></li>

					<li><a id="index_href_about"
						href="../general-info/about-us.html">關於我們<span
							class="submenu-indicator"></span></a></li>

					<li><a id="index_href_cart" href="./member/cart.html">購物車<span
							class="submenu-indicator"></span></a></li>

				</ul>

				<ul class="nav-menu nav-menu-social align-to-right"
					id="login-register-menu">
					<li class="add-listing light"><a href="JavaScript:void(0);"
						data-bs-toggle="modal" data-bs-target="#login"
						class="fw-medium text-muted-2"> <span
							class="svg-icon svg-icon-2hx me-1"> <svg width="22"
									height="22" viewBox="0 0 18 18" fill="none"
									xmlns="http://www.w3.org/2000/svg">
									<path opacity="0.3"
										d="M16.5 9C16.5 13.125 13.125 16.5 9 16.5C4.875 16.5 1.5 13.125 1.5 9C1.5 4.875 4.875 1.5 9 1.5C13.125 1.5 16.5 4.875 16.5 9Z"
										fill="currentColor" />
									<path
										d="M9 16.5C10.95 16.5 12.75 15.75 14.025 14.55C13.425 12.675 11.4 11.25 9 11.25C6.6 11.25 4.57499 12.675 3.97499 14.55C5.24999 15.75 7.05 16.5 9 16.5Z"
										fill="currentColor" />
									<rect x="7" y="6" width="4" height="4" rx="2"
										fill="currentColor" />
								</svg>
						</span>註冊或登錄
					</a></li>
				</ul>

				<ul class="nav-menu nav-menu-social align-to-right" id="logout-menu"
					style="display: none;">
					<li>
						<div class="btn-group account-drop">
							<button type="button"
								class="btn btn-order-by-filt dropdown-toggle" id="showbutton"
								data-bs-toggle="dropdown" aria-haspopup="true"
								aria-expanded="false">
								<img id="member_header_photo_base64"
									src="https://placehold.co/500x500" class="avater-img" alt="">您好！<span
									id="member_name"> </span>
							</button>
							<div class="dropdown-menu pull-right animated flipInX"
								id="showing">
								<a href="./member/member-details.html"><i
									class="fa-solid fa-gauge"></i>個人資料</a> <a href=" " id="btn_logout"><i
									class="fa-solid fa-power-off"></i>登出</a>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</nav>
	</div>
</div>

<!-- End Navigation -->

<!-- ============================================================== -->
<!-- Top header  -->
<!-- ============================================================== -->



<a id="back2Top" class="top-scroll" title="Back to top" href="#"><i
	class="ti-arrow-up"></i></a>



<!-- ============================================================== -->
<!-- End Wrapper -->
<!-- ============================================================== -->
<input type="hidden" id="img_member_header_id" value="">
<input type="hidden" id="member_id" value="">


<script>
	const member_header_photo_base64 = document.getElementById('member_header_photo_base64');
	const membername = document.querySelector('#member_name');
	const loginRegisterMenu = document.querySelector('#login-register-menu');
	const logoutMenu = document.querySelector('#logout-menu');
	const logo_href = document.querySelector('#logo_href');
	const index_href = document.querySelector('#index_href');
	const index_href_search_activities = document.querySelector('#index_href_search-activities');
	const index_href_contact = document.querySelector('#index_href_contact');
	const index_href_faq = document.querySelector('#index_href_faq');
	const index_href_about = document.querySelector('#index_href_about');
	const index_href_cart = document.querySelector('#index_href_cart');
	const img_member_header_id = document.querySelector('#img_member_header_id');
	// 			const memberid = document.querySelector('#memberid');
// 	const memberid = sessionStorage.getItem('memberid');
	const memberid = localStorage.getItem('memberid');


	// to do list ...要判斷如果不是在member路徑底下(首頁)，如果不是要用別的
	// 			fetch('/chill-tribe/member/find/') 
	// 			fetch(`find/${img_member_header_id.value}`)
	// 			fetch(`/chill-tribe/member/find/${img_member_header_id}`)
	function setmembername(a) {
		fetch(`http://localhost:8080/chill-tribe/member/find/${a}`)
// 		fetch(`find/${a}`)
			.then(resp => resp.json())
			.then(member => {
				membername.innerText = member.membername;
				img_member_header_id.value = member.memberid;
				// 				memberid = member.memberid;
				if (member.photobase64 == null) {
// 					member_header_photo_base64.src = 'https://placehold.co/500x500';
// 					member_header_photo_base64.src = 'https://imgur.com/a/jDrbFs9';
					member_header_photo_base64.src = 'http://localhost:8080/chill-tribe/activity/asset/no-image.jpg';
// 					console.log("照片是空的");
				} else {
					member_header_photo_base64.src = 'data:image/png;base64,' + member.photobase64;
// 					console.log("77777有照片囉");
				}

				if (member.membername != null) {
					// 顯示登出&隱藏登錄或註冊
					membername.innerText = member.membername;
					loginRegisterMenu.style.display = 'none';
					logoutMenu.style.display = 'block';
				}
			});
	}

	if(localStorage.getItem('memberid') !== null && localStorage.getItem('memberid') !== 'null') {
	setmembername(memberid);
	}

	// 拼接路徑字串，塞回去標籤內
	let baseUrl = window.location.origin + '/' + window.location.pathname.split('/')[1];
// 	console.log(baseUrl);
	let chilltribeindex = baseUrl + '/chilltribe.html';
	let chilltribecart = baseUrl + '/member/cart.html';
	let chilltribesearch_activities = baseUrl + '/activity/search-activities.html';
	let chilltribecontact = baseUrl + '/general-info/contact.html';
	let chilltribefaq = baseUrl + '/general-info/faq.html';
	let chilltribeabout = baseUrl + '/general-info/about-us.html';
	let chilltribecar = baseUrl + '/shoppingcart/shopping-cart.html';
	let indexhref = baseUrl + '/chilltribe.html';
	logo_href.setAttribute('href', chilltribeindex);
	index_href.setAttribute('href', chilltribeindex);
	index_href_cart.setAttribute('href', chilltribecart);
	index_href_search_activities.setAttribute('href', chilltribesearch_activities);
	index_href_contact.setAttribute('href', chilltribecontact);
	index_href_faq.setAttribute('href', chilltribefaq);
	index_href_about.setAttribute('href', chilltribeabout);
	index_href_cart.setAttribute('href', chilltribecar);
	// 拼接路徑字串結束

	// 登出開始
	$('#btn_logout').on("click", function () {
		console.log("登出按鈕觸發");
		sessionStorage.clear();
		localStorage.clear();
		// 				 sessionStorage.removeItem("GoogleEmail");
		// 				 sessionStorage.removeItem("memberid");
		// 				 sessionStorage.removeItem("google");
		// 				 sessionStorage.removeItem("member");
		document.cookie = "JSESSIONID=; Path=/chill-tribe; Expires=Thu, 01 Jan 1970 00:00:00 GMT;";

		// 登出發後端
		fetch(`http://localhost:8080/chill-tribe/member/logout`, {
// 		fetch(`member/logout`, {
			method: 'DELETE'
		});
		// 登出結束
	});


</script>

		<!-- GA埋入開始 -->
		<!-- Google tag (gtag.js) -->
		<script async
			src="https://www.googletagmanager.com/gtag/js?id=G-GM5P5XWVB2"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		
		  gtag('config', 'G-GM5P5XWVB2');
		</script>
		<!-- GA埋入結束 -->